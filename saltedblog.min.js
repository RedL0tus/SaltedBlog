(function(){function a(){return new Promise((h,j)=>{for(var k=document.getElementsByTagName('link'),l=0;l<k.length;l+=1)'manifest'===k[l].getAttribute('rel')&&h(k[l].getAttribute('href'));j('No manifest found')})}function b(h){return new Promise(j=>{-1<window.location.href.indexOf(h)&&window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(k,l,n){l===h&&j(n)}),j(null)})}function c(){return new Promise(()=>{for(let h=0;h<f.QUEUE.length;h+=1)require(['https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.3.0/mustache.min.js'],function(j){document.documentElement.innerHTML=j.render(document.documentElement.innerHTML,f.QUEUE[h]),document.dispatchEvent(f.DONE)})})}async function d(h){f.QUEUE.push(h),'complete'===document.readyState&&(await c())}function e(h,j){return new Promise(k=>{fetch(h).then(l=>l.text()).then(function(l){require([j],function(n){console.log('Rendering using: '+n.info.description),k(n.render(l))})}).catch(l=>console.log('Error while rendering post: '+l))})}let f={};f.START=new Event('SaltedBlogStart'),f.DONE=new Event('SaltedBlogDone'),f.QUEUE=[],f.start=async function(){document.dispatchEvent(f.START);const h=await a();h&&(console.log('Manifest set to '+h),fetch(h).then(j=>j.json()).then(async function(j){let k=await b('post');fetch(j.meta).then(l=>l.json()).then(async function(l){let n={};window.location.pathname.substring(window.location.pathname.lastIndexOf('/')+1).includes(j.modeSettings.index)&&null!=k&&!0===j.modeSettings.redirect&&(window.location.href=window.location.href.replace(j.modeSettings.index,j.modeSettings.post)),Object.assign(n,j),n.index=n.modeSettings.index,n.post=n.modeSettings.post,n.posts=[];for(let o=0;o<l.posts.length;o+=1)n.posts[o]=l.posts[o],n.posts[o].link=j.modeSettings.post+'?post='+n.posts[o].id,!0===j.timeParsing&&(n.posts[o].date=new Date(n.posts[o].date).toLocaleDateString(j.locale,j.timeParsingOptions)),l.posts[o].id===k&&(Object.assign(n,l.posts[o]),n.content=await e(n.file,n.type));d(n)}).catch(l=>'Error while fetching posts meta: '+l)}).catch(j=>console.log('Error while fetching manifest: '+j))),document.addEventListener('DOMContentLoaded',function(){c()}),document.onreadystatechange=function(){'complete'===document.readyState?c():console.log('Document not loaded')}};let g=this;'function'==typeof define&&define.amd?define(function(){'use strict';return f.start(),f}):'undefined'!=typeof module&&module.exports?(module.exports=f,f.start()):(g.SaltedBlog=f,f.start())}).call(this);